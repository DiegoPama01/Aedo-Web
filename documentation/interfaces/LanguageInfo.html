<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>aedo-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">aedo-web documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  LanguageInfo</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/aedo/components/odisea-form/odisea-form.component.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#date" 
>
                                            date
                                        </a>
                                </li>
                                <li>
                                        <a href="#dateType" 
>
                                            dateType
                                        </a>
                                </li>
                                <li>
                                        <a href="#language" 
>
                                            language
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="date"></a>
                                        <span class="name "><b>date</b>
                                            <a href="#date">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>date:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="dateType"></a>
                                        <span class="name "><b>dateType</b>
                                            <a href="#dateType">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>dateType:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="language"></a>
                                        <span class="name "><b>language</b>
                                            <a href="#language">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>language:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  Component,
  OnInit,
  QueryList,
  ViewChild,
  ViewChildren,
  ViewEncapsulation,
} from &#x27;@angular/core&#x27;;
import {
  FormBuilder,
  FormControl,
  FormGroup,
  Validators,
} from &#x27;@angular/forms&#x27;;
import { AuthenticationService } from &#x27;../../services/authentication.service&#x27;;
import { Category } from &#x27;../../models/category.model&#x27;;
import { CategoryDto } from &#x27;../../dto/category.dto&#x27;;
import { CategoryService } from &#x27;../../services/models-services/category.service&#x27;;
import { geohashForLocation } from &#x27;geofire-common&#x27;;
import { ImagesService } from &#x27;../../services/models-services/images.service&#x27;;
import { Language } from &#x27;../../models/language.model&#x27;;
import { LanguageDto } from &#x27;../../dto/language.dto&#x27;;
import { LanguageService } from &#x27;../../services/models-services/languages.service&#x27;;
import { MatCheckbox } from &#x27;@angular/material/checkbox&#x27;;
import { MatStepper } from &#x27;@angular/material/stepper&#x27;;
import { Observable } from &#x27;rxjs&#x27;;
import { Odisea } from &#x27;../../models/odisea.model&#x27;;
import { OdiseaService } from &#x27;../../services/models-services/odiseas.service&#x27;;
import { OdiseaCalendar } from &#x27;../../models/odisea-calendar.model&#x27;;
import { OdiseaCalendarService } from &#x27;../../services/models-services/odisea-calendars.service&#x27;;
import { calendarType } from &#x27;../../interfaces/odisea-calendar.interface&#x27;;
import { Router } from &#x27;@angular/router&#x27;;
import { MatSnackBar } from &#x27;@angular/material/snack-bar&#x27;;

interface LanguageInfo {
  language: string;
  dateType: string;
  date?: Date;
}

@Component({
  selector: &#x27;app-odisea-form&#x27;,
  templateUrl: &#x27;./odisea-form.component.html&#x27;,
  styleUrls: [&#x27;./odisea-form.component.css&#x27;],
  encapsulation: ViewEncapsulation.None,
})
export class OdiseaFormComponent implements OnInit {
  categoryList: CategoryDto[] &#x3D; [];
  languageList: LanguageDto[] &#x3D; [];
  selectedCategoryList: Category[] &#x3D; [];
  selectedLanguageList: Language[] &#x3D; [];
  selectedLocation: any;
  firstStepForm: FormGroup;
  secondStepForm: FormGroup;
  thirdStepForm: FormGroup;
  fourthStepForm: FormGroup;
  selectedCalendarType: string &#x3D; &#x27;frecuencia&#x27;;
  selectedLanguage?: string;
  selectedDateType?: string;
  dateSpecifications: any[] &#x3D; [];
  startDate?: Date;
  endDate?: Date;
  today: Date &#x3D; new Date();
  selectedDate: any &#x3D; new Date();
  @ViewChild(MatStepper) stepper!: MatStepper;
  @ViewChildren(
    &#x27;lunesCheckbox, martesCheckbox, miercolesCheckbox, juevesCheckbox, viernesCheckbox, sabadoCheckbox, domingoCheckbox&#x27;
  )
  checkboxes?: QueryList&lt;MatCheckbox&gt;;
  range &#x3D; new FormGroup({
    start: new FormControl&lt;Date | null&gt;(null),
    end: new FormControl&lt;Date | null&gt;(null),
  });
  selectedLanguages: LanguageInfo[] &#x3D; [];

  constructor(
    private formBuilder: FormBuilder,
    private categoryService: CategoryService,
    private languageService: LanguageService,
    private imageService: ImagesService,
    private odiseaService: OdiseaService,
    private odiseaCalendarService: OdiseaCalendarService,
    private authService: AuthenticationService,
    private router: Router,
    private snackBar: MatSnackBar
  ) {
    this.firstStepForm &#x3D; this.formBuilder.group({
      name: [&#x27;&#x27;, Validators.required],
      description: [&#x27;&#x27;, Validators.required],
      capacity: [&#x27;10&#x27;, [Validators.required, Validators.min(1)]],
      tags: [&#x27;&#x27;, Validators.required],
      languages: [&#x27;&#x27;, Validators.required],
      price: [&#x27;0&#x27;],
    });

    this.secondStepForm &#x3D; this.formBuilder.group({
      location: [&#x27;&#x27;, Validators.required],
    });

    this.thirdStepForm &#x3D; this.formBuilder.group({
      images: [&#x27;&#x27;, Validators.required],
    });

    this.fourthStepForm &#x3D; this.formBuilder.group({
      start: [&#x27;&#x27;],
      end: [&#x27;&#x27;],
    });
  }

  saveDate() {
    let index &#x3D; this.selectedLanguages.findIndex(
      (language) &#x3D;&gt; language.language &#x3D;&#x3D;&#x3D; this.selectedLanguage
    );
    this.selectedLanguages[index].dateType &#x3D; this.selectedCalendarType!;

    if (this.selectedCalendarType &#x3D;&#x3D;&#x3D; &#x27;frecuencia&#x27;) {
      const frequencyDate: any &#x3D; {
        Mon: false,
        Tue: false,
        Wed: false,
        Thu: false,
        Fri: false,
        Sat: false,
        Sun: false,
      };

      this.checkboxes
        ?.filter((checkbox) &#x3D;&gt; checkbox.checked)
        .forEach((checkbox) &#x3D;&gt; {
          frequencyDate[checkbox._elementRef.nativeElement.id] &#x3D; true;
        });

      this.selectedLanguages[index].date &#x3D; frequencyDate;
    } else if (this.selectedCalendarType &#x3D;&#x3D;&#x3D; &#x27;fechas-especificas&#x27;) {
      this.selectedLanguages[index].date &#x3D; this.selectedDate!;
    } else {
      console.log(&#x27;3&#x27;);
      const startDate &#x3D; this.range.get(&#x27;start&#x27;)?.value;
      const endDate &#x3D; this.range.get(&#x27;end&#x27;)?.value;
      this.selectedDate &#x3D; { startDate, endDate };
      this.selectedLanguages[index].date &#x3D; this.selectedDate!;
    }

    console.log(this.selectedLanguages);
  }

  isNextButtonDisabled(): boolean {
    return this.selectedLanguages.some((language) &#x3D;&gt; !language.date);
  }

  onDateSelected(date: string) {
    console.log(&#x27;Fecha seleccionada:&#x27;, date);
    this.selectedDate &#x3D; new Date(date);
  }

  getSelectedCheckboxes(): MatCheckbox[] {
    return this.checkboxes!.filter((checkbox) &#x3D;&gt; checkbox.checked);
  }

  ngOnInit(): void {
    this.loadCategories();
    this.loadLanguages();
  }

  private loadCategories(): void {
    this.categoryService
      .getCollection()
      .subscribe((categories: CategoryDto[]) &#x3D;&gt; {
        this.categoryList &#x3D; categories;
      });
  }

  private loadLanguages(): void {
    this.languageService
      .getCollection()
      .subscribe((languages: LanguageDto[]) &#x3D;&gt; {
        this.languageList &#x3D; languages;
      });
  }

  categorySelected(category: CategoryDto) {
    const index &#x3D; this.selectedCategoryList.indexOf(category.getCategory());
    if (index !&#x3D;&#x3D; -1) {
      this.selectedCategoryList.splice(index, 1);
    } else {
      this.selectedCategoryList.push(category.getCategory());
    }
  }

  languageSelected(language: LanguageDto) {
    const index &#x3D; this.selectedLanguageList.findIndex(
      (item) &#x3D;&gt; item &#x3D;&#x3D;&#x3D; language.getLanguage()
    );
    if (index !&#x3D;&#x3D; -1) {
      this.selectedLanguageList.splice(index, 1);
      this.selectedLanguages.splice(index, 1);
    } else {
      this.selectedLanguageList.push(language.getLanguage());
      this.selectedLanguages.push({
        language: language.getLanguage().item,
        dateType: &#x27;&#x27;,
        date: undefined,
      });
    }
  }

  private listCategories: Observable&lt;CategoryDto[]&gt; &#x3D;
    this.categoryService.getCollection();
  private listLanguages: Observable&lt;LanguageDto[]&gt; &#x3D;
    this.languageService.getCollection();

  public getCategoryList(): Observable&lt;CategoryDto[]&gt; {
    return this.listCategories;
  }

  public getLanguageList(): Observable&lt;LanguageDto[]&gt; {
    return this.listLanguages;
  }

  onlyNumber(event: any) {
    const pattern &#x3D; /[0-9]/;
    const inputChar &#x3D; String.fromCharCode(event.charCode);

    if (!pattern.test(inputChar)) {
      event.preventDefault();
    }
  }

  markerSelected(marker: any) {
    this.selectedLocation &#x3D; {
      lat: marker.getLatLng().lat,
      lon: marker.getLatLng().lng,
    };
  }

  submitFirstForm() {
    this.firstStepForm.get(&#x27;tags&#x27;)!.setValue(this.selectedCategoryList);
    this.firstStepForm.get(&#x27;languages&#x27;)!.setValue(this.selectedLanguageList);
    if (this.firstStepForm.get(&#x27;price&#x27;)!) {
      this.firstStepForm.get(&#x27;price&#x27;)!.setValue(0);
    }
    if (this.firstStepForm.valid) {
      this.stepper.next();
    } else {
      console.log(&#x27;Por favor, completa todos los campos requeridos&#x27;);
    }
  }

  submitSecondForm() {
    this.secondStepForm.get(&#x27;location&#x27;)!.setValue(this.selectedLocation);
    if (this.secondStepForm.valid) {
      this.stepper.next();
    } else {
      console.log(&#x27;Por favor, completa todos los campos requeridos&#x27;);
    }
  }

  selectedFiles: any[] &#x3D; [];

  handleFileInput(event: any) {
    const files &#x3D; event.target.files;
    for (const file of files) {
      const reader &#x3D; new FileReader();
      reader.onload &#x3D; (e: any) &#x3D;&gt; {
        this.selectedFiles.push(e.target.result);
      };
      reader.readAsDataURL(file);
    }
  }

  submitThirdForm() {
    this.thirdStepForm.get(&#x27;images&#x27;)!.setValue(this.selectedFiles);
    if (this.thirdStepForm.valid) {
      this.stepper.next();
    } else {
      console.log(&#x27;Por favor, completa todos los campos requeridos&#x27;);
    }
  }

  submitFourthForm() {
    if (this.fourthStepForm.valid) {
      this.stepper.next();
    } else {
      console.log(&#x27;Por favor, completa todos los campos requeridos&#x27;);
    }
  }

  removeFile(index: number) {
    this.selectedFiles.splice(index, 1);
  }

  submitAll() {
    let uid &#x3D; this.authService.getUid();
    let odiseaId: string;

    let languageList: Language[] &#x3D; this.firstStepForm.get(&#x27;languages&#x27;)?.value;

    let categoryList: Category[] &#x3D; this.firstStepForm.get(&#x27;tags&#x27;)?.value;
    let arrayCategory &#x3D; categoryList.map((category) &#x3D;&gt; category.getName());

    let { lat, lon } &#x3D; this.secondStepForm.get(&#x27;location&#x27;)?.value;
    let geohash &#x3D; geohashForLocation([lat, lon]);
    let odiseaLocation &#x3D; { latitude: lat, longitude: lon, geohash: geohash };

    let odisea: Odisea &#x3D; new Odisea(
      this.firstStepForm.get(&#x27;description&#x27;)?.value,
      [],
      languageList,
      this.firstStepForm.get(&#x27;capacity&#x27;)?.value,
      this.firstStepForm.get(&#x27;name&#x27;)?.value,
      0,
      0,
      uid,
      arrayCategory,
      odiseaLocation,
      this.firstStepForm.get(&#x27;price&#x27;)?.value
    );

    this.odiseaService.create(odisea).then((docRef) &#x3D;&gt; {
      odiseaId &#x3D; docRef.id;
      console.log(&#x27;Odisea guardada con ID:&#x27;, odiseaId);

      this.thirdStepForm
        .get(&#x27;images&#x27;)
        ?.value!.forEach(async (image: any, index: number) &#x3D;&gt; {
          const imageUrl &#x3D; await this.imageService.uploadImage(
            odiseaId + &#x27;/L&#x27; + index,
            image
          );
          const odiseaDto &#x3D; await this.odiseaService.getById(odiseaId);
          odiseaDto.setImage([
            ...odiseaDto.getImage(),
            { assetID: &#x27;images/&#x27; + odiseaId + &#x27;/L&#x27; + index },
          ]);
          await this.odiseaService.update(odiseaDto);
        });

      this.selectedLanguages.forEach((language) &#x3D;&gt; {
        let type: calendarType;
        let dates: any;
        let odiseaLang &#x3D; new Language(
          language.language.split(&#x27; &#x27;)[0].toUpperCase(),
          language.language
        );

        if (language.dateType &#x3D;&#x3D;&#x3D; &#x27;frecuencia&#x27;) {
          type &#x3D; calendarType.frequencyDatesCalendar;
          dates &#x3D; language.date;
        } else if (language.dateType &#x3D;&#x3D;&#x3D; &#x27;fecha-especifica&#x27;) {
          type &#x3D; calendarType.singleDateCalendar;
          dates &#x3D; language.date;
        } else {
          type &#x3D; calendarType.rangeDatesCalendar;
          dates &#x3D; language.date;
        }
        let calendar &#x3D; new OdiseaCalendar(type, dates, odiseaLang, odiseaId);
        this.odiseaCalendarService.create(calendar);
      });
    });

    this.snackBar.open(&#x27;Todo ha sido guardado&#x27;, &#x27;Cerrar&#x27;);
    this.router.navigate([&#x27;/home&#x27;]);
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'LanguageInfo.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
